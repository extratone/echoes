"use strict";var authLogin={apiUrl:"",def:"",config:{},onPost:!1,dev:function e(){var t=navigator.userAgent.toLowerCase(),o=/micromessenger/i.test(t),a=/qq/i.test(t),n=/godlike/i.test(t),i=/weibo/i.test(t),r=/line/i.test(t),u=/twitter/i.test(t),c=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.indexOf("FBAN")>-1||e.indexOf("FBAV")>-1}(),e="";return o?e="weixin":n?e="":a?e="qq":i?e="weibo":c?e="facebook":r?e="line":u&&(e="twitter"),e},urlps:function(e){var t,o,a,n,i,r,u,c,s,f="";for(e.indexOf("#")>=0&&(f=e.substr(e.indexOf("#")+1,e.length),e=e.replace("#"+f,"")),t="",e.indexOf("?")>=0&&(t=e.substr(e.indexOf("?")+1,e.length),e=e.replace("?"+t,"")),o=e,a=t.split("&"),n=a.length,u=[],c=[],i=0;n>i;i++)r=a[i].split("="),u[r[0]]=r[1];for(s=f.split("&"),n=s.length,i=0;n>i;i++)r=s[i].split("="),c[r[0]]=r[1];return{lists:function(){return u},data:function(e,t){if("undefined"==typeof t){var o=u[e.toLowerCase()];return"undefined"==typeof o?"":o}u[e]=t},hash:function(e,t){if("undefined"==typeof t){var o=c[e.toLowerCase()];return"undefined"==typeof o?"":o}c[e]=t},getHash:function(){var e,t,o=[];for(e in c)c[e]&&o.push(e+"="+c[e]);return t="",o.length>0&&(t=o.join("&")),t},url:function(){var e,t,a,n=[];for(e in u)u[e]&&n.push(e+"="+u[e]);t="",n.length>0&&(t="?"+n.join("&")),n=[];for(e in c)c[e]&&n.push(e+"="+c[e]);return a="",n.length>0&&(a="#"+n.join("&")),o+""+t+a}}},check:function(){authLogin.config.fbAppid=371081370126685,authLogin.config.fbCallback="https://www.eveechoes.com/callback/",authLogin.config.ttCallback="https://www.eveechoes.com/callback/";var e=authLogin.urlps(location.href),t=authLogin.dev();switch(authLogin.def&&(t=authLogin.def),t){case"facebook":return e.data("code")?!0:!1;case"twitter":return e.data("oauth_token")?!0:!1}},go:function(e){var t=authLogin.urlps(location.href),o=authLogin.dev();authLogin.def&&(o=authLogin.def);var a="";if(void 0!=typeof e)for(var n in e)"scope"==n?a=e[n]:t.data(n,e[n]);t.data("code",""),t.data("oauth_token",""),t.data("oauth_verifier",""),t.data("state",""),t.data("rurl",""),t.data("r",""),t.data("nie","");var i=t.url(),r="";switch(o){case"facebook":if(!authLogin.config.fbAppid)return void console.log("\u5f53\u524d\u4ea7\u54c1\u6ca1\u6709\u914d\u7f6eFacebook\u7684\u6388\u6743\u8d26\u53f7");var u=encodeURIComponent(i);r="https://www.facebook.com/dialog/oauth?client_id="+authLogin.config.fbAppid+"&redirect_uri="+encodeURIComponent(authLogin.config.fbCallback)+"&scope=public_profile,email&state="+u,location.href=r;break;case"twitter":if(!authLogin.apiUrl)return void console.log("miss apiUrl for twitter");if(authLogin.onPost)return;authLogin.onPost=!0,i=authLogin.config.ttCallback+"?link="+encodeURIComponent(i),$.ajax({url:authLogin.apiUrl,data:{callbackUrl:i},dataType:"jsonp",success:function(e){authLogin.onPost=!1,1==e.success?location.href="https://api.twitter.com/oauth/authorize?oauth_token="+e.data:alert(e.msg)},error:function(){authLogin.onPost=!1,alert("network error")}})}},subscribemsg:function(e){if(e||(e={}),"undefined"==typeof e.scene&&(e.scene=0),"undefined"==typeof e.template_id&&(e.template_id="ztU3MvdeFsEXzSUC85sF4awRKql8pxL5_bp4bdA8sf8"),"undefined"==typeof e.link){var t=authLogin.urlps(location.href);t.data("code",""),t.data("oauth_token",""),t.data("oauth_verifier",""),t.data("state",""),t.data("rurl",""),t.data("r",""),t.data("nie","");var o=t.url();e.link="https://game.163.com/callback/subscribemsg.html?link="+encodeURIComponent(o)}location.href="https://mp.weixin.qq.com/mp/subscribemsg?action=get_confirm&appid=wx85f583832dbd07e9&scene="+e.scene+"&template_id="+e.template_id+"&redirect_url="+encodeURIComponent(e.link)+"&reserved=163#wechat_redirect"},data:function(e){function t(e){var t=authLogin.urlps(location.href),o=authLogin.dev()||authLogin.def,i=t.data("page_key"),r=t.data("share_key"),u="",c="",s={page_key:i,need_userinfo:1};switch(r&&(s={share_key:r,need_userinfo:1}),o){case"facebook":u=t.data("code"),s.code=u,s.redirect_uri=authLogin.config.fbCallback,c="fb/login";break;case"twitter":u=t.data("oauth_token"),s.oauth_token=u,s.oauth_verifier=t.data("oauth_verifier"),c="twitter/login"}$.ajax({url:n+c,data:s,dataType:"jsonp",success:function(t){if(1==t.success)e(t);else{if(!a)return;t.msg||(t.msg=t.error),-1!=t.msg.indexOf("invalid")?authLogin.go():"\u65e0\u6548\u7684Code\uff1a"==t.msg?authLogin.go():-1!=t.msg.toLowerCase().indexOf("code")?authLogin.go():-1!=t.msg.toLowerCase().indexOf("req_id")?authLogin.go():-1!=t.msg.toLowerCase().indexOf("\u4fe1\u606f\u5f02\u5e38")?authLogin.go():-1!=t.msg.toLowerCase().indexOf("failed")?authLogin.go():-1!=t.msg.toLowerCase().indexOf("error")?authLogin.go():alert(t.msg)}},error:function(){alert("\u7f51\u7edc\u4fe1\u53f7\u4e0d\u597d\uff0c\u8bf7\u5237\u65b0\u518d\u8bd5")}})}var o=e.pro||"",a=e.loginErrorAutoJump,n=e.apiUrl,i=authLogin.dev();i||(authLogin.def=e.def||"weibo"),authLogin.apiUrl=n+"twitter/request_token",authLogin.check(o)?("function"==typeof e.authCallback&&e.authCallback(),t(function(t){"function"==typeof e.authApiCallback&&e.authApiCallback(t)})):authLogin.go()}};